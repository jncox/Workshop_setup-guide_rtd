
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Install and Configure Active Directory on Windows 2012R2 Domain Controller &#8212; Nutanix Workshop Setup Guide  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="install-and-configure-active-directory-on-windows-2012r2-domain-controller">
<h1><a class="toc-backref" href="#id1"><strong>Install and Configure Active Directory on Windows 2012R2 Domain Controller</strong></a><a class="headerlink" href="#install-and-configure-active-directory-on-windows-2012r2-domain-controller" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#install-and-configure-active-directory-on-windows-2012r2-domain-controller" id="id1"><strong>Install and Configure Active Directory on Windows 2012R2 Domain Controller</strong></a><ul>
<li><a class="reference internal" href="#connectivity-instructions" id="id2"><strong>Connectivity Instructions:</strong></a></li>
<li><a class="reference internal" href="#overview" id="id3">Overview</a></li>
<li><a class="reference internal" href="#step-1a-deploying-the-windows-2012r2-server-from-scratch" id="id4"><strong>Step 1a — Deploying the Windows 2012R2 Server from scratch</strong></a></li>
<li><a class="reference internal" href="#step-1b-deploying-the-windows-2012r2-server-from-pre-deployed-hpoc-image" id="id5"><strong>Step 1b — Deploying the Windows 2012R2 Server from Pre-Deployed HPOC Image</strong></a></li>
<li><a class="reference internal" href="#step-2-configuring-windows-server-settings" id="id6"><strong>Step 2 — Configuring Windows Server Settings</strong></a></li>
<li><a class="reference internal" href="#step-3-installing-domain-services-role-ad" id="id7"><strong>Step 3 — Installing Domain Services Role (AD)</strong></a></li>
<li><a class="reference internal" href="#step-4-configuring-domain-services-role-ad" id="id8"><strong>Step 4 — Configuring Domain Services Role (AD)</strong></a></li>
<li><a class="reference internal" href="#step-5-adding-workshop-users-group" id="id9"><strong>Step 5 — Adding Workshop Users &amp; Group</strong></a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="connectivity-instructions">
<h2><a class="toc-backref" href="#id2"><strong>Connectivity Instructions:</strong></a><a class="headerlink" href="#connectivity-instructions" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>DC IP</td>
<td>10.x.x.40</td>
</tr>
<tr class="row-even"><td>Username</td>
<td>Administrator</td>
</tr>
<tr class="row-odd"><td>Password</td>
<td>HPOC Password</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id3">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>In this guide we will setup a Windows Domain Controller, and configure Active Directory Domain Services. We will also create 20 users and a bootcamp users group for them.</p>
<p><strong>Note:</strong> You can do either of these depending on if you want to build from scratch or use the one deployed by the HPOC system.</p>
</div>
<div class="section" id="step-1a-deploying-the-windows-2012r2-server-from-scratch">
<h2><a class="toc-backref" href="#id4"><strong>Step 1a — Deploying the Windows 2012R2 Server from scratch</strong></a><a class="headerlink" href="#step-1a-deploying-the-windows-2012r2-server-from-scratch" title="Permalink to this headline">¶</a></h2>
<p>Do this step if you are deploying from a Widows 2012R2 ISO</p>
<ol class="arabic simple">
<li>Go To VM –&gt; Table</li>
<li>Create VM</li>
<li>Name = DC</li>
<li>Description = bootcamp.local Domain Controller</li>
<li>vCPUS = 2</li>
<li>Cores = 1</li>
<li>Memory = 4Gig</li>
<li>Set First CDROM to use W2K12R2 ISO</li>
<li>Add 80Gig Disk on Bootcamp Storage Container</li>
<li>Add 2nd CDROM and set to use VirtIO drivers 1.0.1 ISO</li>
<li>Add New NIC, and select the bootcamp network</li>
<li>IP Address = 10.x.x.40</li>
<li>Power on VM, and run through the Windows Installation</li>
<li>Use the HPOC password as the Administrator password</li>
</ol>
<p><strong>Note:</strong> Remember to select all 3 drivers from VirtIO disk when you are at the “Select Install Disk” section.</p>
<p><strong>OR Do This</strong></p>
</div>
<div class="section" id="step-1b-deploying-the-windows-2012r2-server-from-pre-deployed-hpoc-image">
<h2><a class="toc-backref" href="#id5"><strong>Step 1b — Deploying the Windows 2012R2 Server from Pre-Deployed HPOC Image</strong></a><a class="headerlink" href="#step-1b-deploying-the-windows-2012r2-server-from-pre-deployed-hpoc-image" title="Permalink to this headline">¶</a></h2>
<p>Do this step if you are using the Pre-Deployed Windows 2012R2 VM
(These Images are deployed if you select Windows VMs during HPOC Reservation Process)</p>
<ol class="arabic simple">
<li>Go To VM –&gt; Table</li>
<li>Select the <strong>Windows 2012 VM</strong> and click <strong>Update</strong></li>
<li>Change Name from “Windows 2012 VM” to “DC”</li>
<li>Change Description to “bootcamp.local Domain Controller”</li>
<li>Delete the Rx-Automation-Network NIC</li>
<li>Add Bootcamp NIC</li>
<li>IP Address = 10.x.x.40</li>
<li>Power on VM</li>
<li>Go through the configuration screens</li>
<li>Use the HPOC password as the Administrator password</li>
</ol>
</div>
<div class="section" id="step-2-configuring-windows-server-settings">
<h2><a class="toc-backref" href="#id6"><strong>Step 2 — Configuring Windows Server Settings</strong></a><a class="headerlink" href="#step-2-configuring-windows-server-settings" title="Permalink to this headline">¶</a></h2>
<p>In This step we will configure the Windows OS settings we need before we install the AD Role</p>
<ol class="arabic simple">
<li>Log into the DC VM</li>
<li>Select <strong>Local Server</strong> from the left ribbon in Server Manager</li>
<li>In the Properties Window, select the Ethernet settings</li>
<li>Right click on Ethernet, and configure the IPV4 address with the following info</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>IP</td>
<td>10.x.x.40</td>
</tr>
<tr class="row-even"><td>Netmask</td>
<td>255.255.255.128</td>
</tr>
<tr class="row-odd"><td>Gateway</td>
<td>10.x.x.1</td>
</tr>
<tr class="row-even"><td>DNS 1</td>
<td>10.21.253.10</td>
</tr>
<tr class="row-odd"><td>DNS 2</td>
<td>10.21.253.11</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="5">
<li>In the Properties Window, Make Sure Remote Desktop is “Enabled”</li>
<li>In the Properties Window, Make Sure Windows Firewall is “Off”</li>
<li>In the Properties Window, select Computer Name.</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Computer Name</td>
<td>DC</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="8">
<li>Restart Computer</li>
</ol>
</div>
<div class="section" id="step-3-installing-domain-services-role-ad">
<h2><a class="toc-backref" href="#id7"><strong>Step 3 — Installing Domain Services Role (AD)</strong></a><a class="headerlink" href="#step-3-installing-domain-services-role-ad" title="Permalink to this headline">¶</a></h2>
<p>In this step we will be installing Domain Services Role</p>
<ol class="arabic simple">
<li>Log into the DC VM</li>
<li>Select <strong>Add roles and feature</strong> from the Dashboard in Server Manager</li>
<li>Click <strong>Next</strong> on the initial screen</li>
<li>Installation Type: Role-based or Feature Based installation – Hit <strong>Next</strong></li>
<li>Select Default Server (DC) - Hit <strong>Next</strong></li>
<li>Select Active Director Domain Services</li>
<li>Add Features - Hit <strong>Next</strong></li>
<li>Select AD DS - Hit <strong>Next</strong></li>
<li>Confirmation - Hit <strong>Install</strong> (Check “Restart the destination server automatically if required”)</li>
</ol>
<p><strong>Note:</strong> Monitor the install, and select <strong>Close</strong> when you see the installation succeeded</p>
</div>
<div class="section" id="step-4-configuring-domain-services-role-ad">
<h2><a class="toc-backref" href="#id8"><strong>Step 4 — Configuring Domain Services Role (AD)</strong></a><a class="headerlink" href="#step-4-configuring-domain-services-role-ad" title="Permalink to this headline">¶</a></h2>
<p>In this step we will be configuring Active Directory for use by our Workshop</p>
<ol class="arabic simple">
<li>Select <strong>AD DS</strong> from the left ribbon in Server Manger</li>
<li>Click <strong>more…</strong> from yellow highlighted bar at the top of the dialog box</li>
<li>Click <strong>Promote this server to a domain controller</strong> under action</li>
<li>Select “Add a new forest”, Enter “Root domain name”, and then click <strong>Next</strong></li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Root domain name</td>
<td>bootcamp.local</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="5">
<li>DSRM Password = HPOC Password - hit <strong>Next</strong></li>
<li>DNS Options - hit <strong>Next</strong></li>
<li>NetBIOS Name - hit <strong>Next</strong></li>
<li>Paths - hit <strong>Next</strong></li>
<li>Review Options - hit <strong>Next</strong></li>
<li>PreReq Check (ignore review items) - hit <strong>Install</strong></li>
</ol>
<p><strong>Note:</strong> Server will reboot automatically</p>
</div>
<div class="section" id="step-5-adding-workshop-users-group">
<h2><a class="toc-backref" href="#id9"><strong>Step 5 — Adding Workshop Users &amp; Group</strong></a><a class="headerlink" href="#step-5-adding-workshop-users-group" title="Permalink to this headline">¶</a></h2>
<p>In this step we will run a powershell script that will create the “Bootcamp Users” AD group, and user01-user20
(also adding them to the Bootcamp Users group)</p>
<p><strong>Copy the contents of the following script and csv, and create the files on the Server in “C:\scripts”</strong>
<a class="reference external" href="../active_directory/scripts/add-users.ps1">add-users.ps1</a> and <a class="reference external" href="../active_directory/scripts/add-users.csv">add-users.csv</a></p>
<ol class="arabic simple">
<li>Log into the DC VM</li>
<li>create a directory called “scripts” at the root of C:</li>
<li>Create a directory called “logs” in “c:\scripts”</li>
<li>Copy over the add-users.ps1 and add-users.csv to “C:\scripts”</li>
</ol>
<div class="highlight-bash"><div class="highlight"><pre><span></span>Import-module activedirectory

<span class="nv">$Users</span><span class="o">=</span>Import-csv c:<span class="se">\s</span>cripts<span class="se">\a</span>dd-users.csv


<span class="nv">$a</span><span class="o">=</span><span class="m">1</span><span class="p">;</span>
<span class="nv">$b</span><span class="o">=</span><span class="m">1</span><span class="p">;</span>
<span class="nv">$failedUsers</span> <span class="o">=</span> @<span class="o">()</span>
<span class="nv">$usersAlreadyExist</span> <span class="o">=</span>@<span class="o">()</span>
<span class="nv">$successUsers</span> <span class="o">=</span> @<span class="o">()</span>
<span class="nv">$VerbosePreference</span> <span class="o">=</span> <span class="s2">&quot;Continue&quot;</span>
<span class="nv">$LogFolder</span> <span class="o">=</span> <span class="s2">&quot;c:\scripts\logs&quot;</span>
<span class="nv">$GroupName</span> <span class="o">=</span> <span class="s2">&quot;Bootcamp Users&quot;</span>
<span class="nv">$OU</span> <span class="o">=</span> <span class="s2">&quot;CN=Users, DC=BOOTCAMP,DC=LOCAL&quot;</span>

NEW-ADGroup -name <span class="nv">$GroupName</span> –GroupScope Global

ForEach<span class="o">(</span><span class="nv">$User</span> in <span class="nv">$Users</span><span class="o">){</span>
<span class="nv">$User</span>.FirstName <span class="o">=</span> <span class="nv">$User</span>.FirstName.substring<span class="o">(</span><span class="m">0</span>,1<span class="o">)</span>.toupper<span class="o">()</span>+<span class="nv">$User</span>.FirstName.substring<span class="o">(</span><span class="m">1</span><span class="o">)</span>.tolower<span class="o">()</span>
<span class="nv">$FullName</span> <span class="o">=</span> <span class="nv">$User</span>.FirstName
<span class="nv">$Sam</span> <span class="o">=</span> <span class="nv">$User</span>.FirstName
<span class="nv">$dnsroot</span> <span class="o">=</span> <span class="s1">&#39;@&#39;</span> + <span class="o">(</span>Get-ADDomain<span class="o">)</span>.dnsroot
<span class="nv">$SAM</span> <span class="o">=</span> <span class="nv">$sam</span>.tolower<span class="o">()</span>
<span class="nv">$UPN</span> <span class="o">=</span> <span class="nv">$SAM</span> + <span class="s2">&quot;</span><span class="nv">$dnsroot</span><span class="s2">&quot;</span>
<span class="nv">$email</span> <span class="o">=</span> <span class="nv">$Sam</span> + <span class="s2">&quot;</span><span class="nv">$dnsroot</span><span class="s2">&quot;</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="nv">$user</span>.password
try <span class="o">{</span>
<span class="k">if</span> <span class="o">(</span>!<span class="o">(</span>get-aduser -Filter <span class="o">{</span>samaccountname -eq <span class="s2">&quot;</span><span class="nv">$SAM</span><span class="s2">&quot;</span><span class="o">})){</span>
New-ADUser -Name <span class="nv">$FullName</span> -AccountPassword <span class="o">(</span>ConvertTo-SecureString <span class="nv">$password</span> -AsPlainText -force<span class="o">)</span> -GivenName <span class="nv">$User</span>.FirstName  -Path <span class="nv">$OU</span> -SamAccountName <span class="nv">$SAM</span> -UserPrincipalName <span class="nv">$UPN</span> -EmailAddress <span class="nv">$Email</span> -Enabled <span class="nv">$TRUE</span>
Add-ADGroupMember -Identity <span class="nv">$GroupName</span> -Member <span class="nv">$Sam</span>
Write-Verbose <span class="s2">&quot;[PASS] Created </span><span class="nv">$FullName</span><span class="s2">&quot;</span>
<span class="nv">$successUsers</span> +<span class="o">=</span> <span class="nv">$FullName</span>
<span class="o">}</span>
<span class="o">}</span>

catch <span class="o">{</span>
Write-Warning <span class="s2">&quot;[ERROR]Can&#39;t create user [</span><span class="k">$(</span><span class="nv">$FullName</span><span class="k">)</span><span class="s2">] : </span><span class="nv">$_</span><span class="s2">&quot;</span>
<span class="nv">$failedUsers</span> +<span class="o">=</span> <span class="nv">$FullName</span>
<span class="o">}</span>
<span class="o">}</span>

<span class="k">if</span> <span class="o">(</span> !<span class="o">(</span>test-path <span class="nv">$LogFolder</span><span class="o">))</span> <span class="o">{</span>
Write-Verbose <span class="s2">&quot;Folder [</span><span class="k">$(</span><span class="nv">$LogFolder</span><span class="k">)</span><span class="s2">] does not exist, creating&quot;</span>
new-item <span class="nv">$LogFolder</span> -type directory -Force
<span class="o">}</span>

Write-verbose <span class="s2">&quot;Writing logs&quot;</span>
<span class="nv">$failedUsers</span> <span class="p">|</span>ForEach-Object <span class="o">{</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nv">$b</span><span class="k">)</span><span class="s2">.) </span><span class="k">$(</span><span class="nv">$_</span><span class="k">)</span><span class="s2">&quot;</span><span class="p">;</span> <span class="nv">$b</span>++<span class="o">}</span> <span class="p">|</span> out-file -FilePath  <span class="nv">$LogFolder</span><span class="se">\F</span>ailedUsers.log -Force -Verbose
<span class="nv">$successUsers</span> <span class="p">|</span> ForEach-Object <span class="o">{</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nv">$a</span><span class="k">)</span><span class="s2">.) </span><span class="k">$(</span><span class="nv">$_</span><span class="k">)</span><span class="s2">&quot;</span><span class="p">;</span> <span class="nv">$a</span>++<span class="o">}</span> <span class="p">|</span>out-file -FilePath  <span class="nv">$LogFolder</span><span class="se">\s</span>uccessUsers.log -Force -Verbose
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li>Update the password in “c:\scripts\add-user.csv” to match the HPOC password</li>
</ol>
<div class="highlight-bash"><div class="highlight"><pre><span></span>Firstname,Password
user01,nutanix/4u
user02,nutanix/4u
user03,nutanix/4u
user04,nutanix/4u
user05,nutanix/4u
user06,nutanix/4u
user07,nutanix/4u
user08,nutanix/4u
user09,nutanix/4u
user10,nutanix/4u
user11,nutanix/4u
user12,nutanix/4u
user13,nutanix/4u
user15,nutanix/4u
user16,nutanix/4u
user17,nutanix/4u
user18,nutanix/4u
user19,nutanix/4u
user20,nutanix/4u
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li>Open Powershell, and run the add-user.ps1</li>
<li>Open Active Directory User &amp; Computers, and verify the users and group are there.</li>
</ol>
<p><strong>Note:</strong> Now you can head back to the <a class="reference external" href="../prism_element/prism_element_setup.rst">Prism_Element_Setup</a>, and configure Authentication and Roles.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Nutanix Global Technical Enablement.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
      |
      <a href="../_sources/active_directory/active_directory_setup.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>